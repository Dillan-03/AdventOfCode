def predictingGuardPath(grid):
    
    grid = [list(line) for line in grid.strip().split("\n")]

    
    # Clockwise turning order
    directions = ['^', '>', 'v', '<'] 
    
    # The directions the guard can move 
    deltas = {
        # Up right down left
        '^': (-1, 0), '>': (0, 1), 'v': (1, 0), '<': (0, -1) 
    }

    # Find the guard's starting position and direction
    startPos, startDir = None, None
    for i, row in enumerate(grid):
        for j, cell in enumerate(row):
            if cell in directions:
                startPos = (i, j)
                startDir = cell
                break
        if startPos:
            break
        

    currentPositions = set()
    visitedPostion = set()
    currentPos = startPos
    currentDir = startDir

    while True:
        currentPositions.add(currentPos)  # Mark the current position as visited
        # print(currentPositions)
        
        current = ()
        x, y = currentPos
        
        dx, dy = deltas[currentDir]
        
        # Calculate the next position by using the delta and if it detects a direction change
        nextPos = (x + dx, y + dy)

        if not (0 <= nextPos[0] < len(grid) and 0 <= nextPos[1] < len(grid[0])):
            break
        if grid[nextPos[0]][nextPos[1]] == '#':
            # Obstacle ahead; turn right 90 degrees
            currentDir = directions[(directions.index(currentDir) + 1) % 4]
        else:
            # Move forward
            currentPos = nextPos
            
            # Update guard position in the grid
            grid[currentPos[0]][currentPos[1]] = currentDir

    return len(currentPositions)

def findObstructionPattern(grid):
    # Parse grid into 2D array
    grid = [list(line) for line in grid.strip().split('\n')]

    directions = ['^', '>', 'v', '<']  # Clockwise turning order
    deltas = {'^': (-1, 0), '>': (0, 1), 'v': (1, 0), '<': (0, -1)}  # Movement deltas

    def simulateGuardwithObstruction(grid, obstruction):
        visitedStates = set()
        # Copy the grid to avoid modifying the original
        currentGrid = [row[:] for row in grid]
        if obstruction:
            x, y = obstruction
            currentGrid[x][y] = '#'

        # Find the guard's initial position and direction
        for i, row in enumerate(currentGrid):
            for j, cell in enumerate(row):
                if cell in directions:
                    currentPos = (i, j)
                    currentDir = cell
                    break

        while True:
            state = (currentPos, currentDir)
            if state in visitedStates:
                return True  # Loop detected
            visitedStates.add(state)

            x, y = currentPos
            dx, dy = deltas[currentDir]
            nextPos = (x + dx, y + dy)
            
            # Out of bounds check
            if not (0 <= nextPos[0] < len(currentGrid) and 0 <= nextPos[1] < len(currentGrid[0])):
                break 

            if currentGrid[nextPos[0]][nextPos[1]] == '#':
                # Obstacle ahead, turn right 90 degrees
                currentDir = directions[(directions.index(currentDir) + 1) % 4]
            else:
                currentPos = nextPos

        return False

    # Find all valid positions for obstruction placement
    obstruction_candidates = set()
    for i, row in enumerate(grid):
        for j, cell in enumerate(row):
            if cell == '.':
                if simulateGuardwithObstruction(grid, obstruction=(i, j)):
                    obstruction_candidates.add((i, j))

    return len(obstruction_candidates)


example = """
....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#..."""

input_map = """
......#........#.............#.##..........................................#.......#...#........#......................#..........
.......................#...#................................#..#.........................................#.....#.....#............
.......................................#.................#..................#....#........................................#.......
.............#...................#.#...............................#....#....#.#.......................................#..#.......
...............................#........##.#..............................#..............................#..#...#..#..............
........................#......................................................................................#..#...............
............................#..........#.......#...................#.....#..................#.....................#..##...........
......................................................##........................#..............#........#..............#..#...#...
............................#.............................................##..........................................#...........
..........#............#....................................#...........#......................................................#..
....#......#.........................................#.......#...............................#..#.##..................#........#..
........................#.#..........##.#..........#......#.......#............................................................#..
..........................................................................................#.#..........................#..........
.............................#............#.......................#................#....................................#.........
...................................#.........................#.............#......#...#................................#.....#....
..........#..................#..#.....................#...#...#.........................................#................#........
....#....#...........#...#..........................................#.............#..#......#................#.....#..............
....................................................................................#......#....##..##....#.......................
...........................#......................#.........##................#............#.......................#...#..........
...........................#....................#............................................#........#.........................#.
..#......#.......#.#...........................#......#....#.#...#.............................#............#..............#......
.......#................#...................................#.........................#..................................#........
..................................................................#...........................................................#...
......................#....#........................................................................................#.............
...#..................#.......#......................................................................#.#....................#.....
................#....................................#.........#..#.........................#...............#.......#.............
.......................................#.................#..................................#...#...........#.....................
....#.....###..................#........#...#..............#............#...............................................#.........
...................#.......................................................#...................................#..................
....#......................................#...##.....#........#......#......#..........................................#.........
......................#............#...............#................#...............................#.............................
......................#..............................................#...........#............#.................................#.
#.#..............................#..#......#.............#.......#......................#...........#........#..........#.........
....#....#.......................................#.......................................................#........................
.......#............................#...........................#.........................#...............#.......................
.....................................#........#.....#........#.......................#...............#..........................#.
....#.......................................#........#......................................................#.................#...
............#..............#...#.......#..#.................................................................................##...#
...#..................#...................#....#............................................................................#.....
.....#....................#...............#.............................................#.....#...............................#...
..............................#.......................#.................#.......................................................#.
.........#....................#..............................................................................#.................#..
......#..................#.........................#.......#.....#...........#....#...................................#......#....
.........#...#......................#......#.................#.........................................#...................#......
....#....#.................................#..#..#........#............................................#.......#..................
....................#...........................#...#............#...........................#....................................
................#................#....#.......................................#....#..........#.#.#..........#....................
....#............................#...................................#.....................................................#.#....
....................................#............#......................#......................##.....................#.......#...
.........................#...................................#.....#................................................#.............
...........#.#..#............................................................................#.#..................................
....#......#.#..................................................#..#....#...#..#...................................#..............
#.........................#.#.................................................................#.#.............................#...
..................#...#........#.......................................................#....#..............................#...#..
.........#..........#.............................................................................................#...............
....................................................................#.......................#..#............#............#........
.................#.................#.............................................#..................................#.............
.#...................................................................................................#................#...........
...#....#.#.#.........#............#..............................................................................................
..................#...#......................................#...#.............#....#....#................#.......................
.....#................................##....................................................................#.....................
............#..................#......#....................#.....#.#.........................##............#............#.......#.
............................#..#.................#.............................................#..................................
............#...............#..........................................................#........#.................................
.......#.......#.......................................##..............##.........................................................
....................#.........#.....#..............#....#.......................................................#.................
...#............................................................#.............................................#...#............#..
....#..............................#...............................#..........................................#...................
............................................................................................................#....................#
..#.............................................................................................................#............#....
..........#...............#.........................................................#...........#.................................
...............#.....................#....................................#....................#.....#...#.....................#..
.#......#.........................................................................................#..#............................
......#..............#........#........#........#.........................................................#.......................
............................#...........#..#.............................................................................#........
..................#..............#.......................................#.........#...............#.....................#.#......
...........................................#.##...................................................................................
.......................#.............................................................................................#............
..........#................................#......#..............................#.................#........#......#.#.........#..
#.......#........................#.....#..........##......#................#......................................#..#..#......#..
........................##........................#....................#......................................#.................#.
..........................#.#........................................................................................#............
..........#.........#.....#......#............#..#................................................##.................#............
........#.....#............##...........................................#..#...............................................#.....#
..............#.......#......................#.....#.......................#.........#........#.................#...#....#........
..............#.................................#.................................................##..............................
................................#........#...........#........................................................#...................
..#.#..................#....#......#..............................#.....#....#.#.............#...............................#....
.....................................................................#......#.........#.......#.........................#....#..#.
.#..........................#.....#...........................................##..^.#..........................#....#....#....#...
...........................#..#................................................................#...#........#.........#...........
......#.................#..............#................#.........#........................#..#........#......#...................
.....#..................#..........#............................................................................#.#...........#...
..........#.........#.................................#......#....#...............#.....................#...#.....................
...........#.......#...........#..#...............#...#..............#...........................................#................
..............................................................#...................................................................
................#..............#.....................#.......#.....................................................#..............
#................#.......#.#..............................#..........................#.............................#..........#...
.#...#.........##..........#......................#....#.........#....................#...............................#.....#.....
....#......#.................#....................................#...............................................................
......#..........#...............................................................#....#...............#.....#.##..................
............................................................#..................#..#...................#.....#.....................
......................#.......#...#....#....................................#.............................#............#..........
.#.............#.....................#...............#.......#...............##.....#..................##...#.....................
........#........................................................###.#..........................................#.................
...##.#................................................................................................#..........................
.............##................#.............#....................#....#......................#........................#.....#....
..#.......#............................................#...............................................#..........................
.................#....#.......................................................#............#..#........................#.......#.#
...#..#......................#............#........#...........................................................................#..
....................................#.......................#.....................................#.....#..#......................
.#...............#......#...........#.....#........##....#.......#.....#...................................................#......
...................#...#............................#..##........#...........................#...........#........................
....................#.#.....................................................................................#......#..............
....#...........#....#...#...#.....................#............................................#..............#..................
......#.#......#................#......................................#...............#..........................................
.......#.#................#..............#.....................#.#......#..................#......................................
.....#................................#..............#.......#......##........#................................#..........#.......
.....................................#......#.........#...#.....#..........#..........................#...........................
......#.......#............................................................#..#....................#...............#.........#....
.........................#...........#.............#......#..#..............................................................#.....
.........#.......##.....#....................................#.....#..............#......#.......#..................##.........#..
.........................#...................#...#.....#...........................................#.................#..#.........
...........#..........#.......................................................................................................#..#
.....#................................................#...........................................................#....#..........
..............#.................................#.............#.........................................................#.........
............#.........................................................#.....#...............................................#.....
..................................................#.................#.............................#....#...#.........#.......#....
........#................#................................................................#................#....................#.
..................##............................###.........#.......#................#........#......#............#..............."""


print(predictingGuardPath(input_map))
print(findObstructionPattern(input_map))